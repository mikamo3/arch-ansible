---
# Home directory setup tasks - Kawazu dotfiles manager installation and repository setup

- name: Install kawazu for dotfiles management
  block:
    - name: Check if kawazu is installed
      ansible.builtin.stat:
        path: /usr/lib/kawazu
      register: kawazu_path

    - name: Install kawazu from repository
      block:
        - name: Clone kawazu repository
          ansible.builtin.git:
            repo: https://github.com/mikamo3/kawazu-git.git
            dest: /tmp/kawazu
          become_user: "{{ ansible_user }}"

        - name: Install kawazu using makepkg
          aur:
            name: kawazu
            use: makepkg
            local_pkgbuild: /tmp/kawazu
          become_user: "{{ ansible_user }}"
      when: not kawazu_path.stat.exists
  when:
    - home.install
    - home.dotfiles.install_kawazu
